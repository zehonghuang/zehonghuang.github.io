+++
title = '【问题大排查】一般环境的网络排障'
date = 2022-07-26T23:08:16+08:00
draft = false
categories = [
    "深度解析",
    "Kubernetes",
]
weight = 2
+++

> 因为最近一段时间，一直在处理各种网路问题，所以痛定思痛从头梳理**一般运维环境下的网络状况**

## 网络不通（持续性）

这个情况没啥好说的，只要不是 DNS 问题，就是服务器挂掉或者端口被禁

### 端口监听挂掉
如果容器内的端口已经没有进程监听了，内核就会返回 Reset 包，客户端就会报错连接被拒绝，可以进容器 netns 检查下端口是否存活:

```shell
netstat -tunlp
```

### iptables 规则问题

检查报文是否有命中丢弃报文的 iptables 规则:

```shell
iptables -t filter -nvL
iptables -t nat -nvL
iptables -t raw -nvL
iptables -t mangle -nvL
iptables-save
```
<!--more-->

### 网络不通（间歇性）或速度慢