<!doctype html><html lang=ja><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"><title>【Redis源码分析】Redis启动过程是这样的！ - 维修区刷紫</title>
<meta property="og:title" content="【Redis源码分析】Redis启动过程是这样的！ - 维修区刷紫"><meta name=twitter:title content="【Redis源码分析】Redis启动过程是这样的！ - 维修区刷紫"><meta name=description content="redis的源码确实是比我想象中要好读，本身是过程式编程，所以很多核心逻辑已经包含在main函数的调用链，流程非常长，耐心看下去还是能get到些东西的。"><meta property="og:description" content="redis的源码确实是比我想象中要好读，本身是过程式编程，所以很多核心逻辑已经包含在main函数的调用链，流程非常长，耐心看下去还是能get到些东西的。"><meta name=twitter:description content="redis的源码确实是比我想象中要好读，本身是过程式编程，所以很多核心逻辑已经包含在main函数的调用链，流程非常长，耐心看下去还是能get到些东西的。"><meta name=author content="金汤力"><link rel=icon type=image/x-icon href=/images/favicon.ico><meta property="og:site_name" content="维修区刷紫"><meta property="og:url" content="/redis%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90redis%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B%E6%98%AF%E8%BF%99%E6%A0%B7%E7%9A%84/"><meta property="og:type" content="article"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.120.2"><script src=https://cdnjs.cloudflare.com/ajax/libs/pako/2.0.4/pako.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/Base64/1.3.0/base64.min.js integrity="sha512-IFxgh3q1bUsg/sL6qotMkJZTOvPyYSS6mRSSIVnJndN5j9vWcQ+oJyHkelIkRAOaKgdU1ibHJOs4HX15sPtZKw==" crossorigin=anonymous referrerpolicy=no-referrer></script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?4b5f7da576488071eb46ec9fe633fa64",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel=stylesheet href=/css/style.css media=all><link rel=stylesheet href=/css/style-dark.css media="all and (prefers-color-scheme: dark)"><link rel=stylesheet href=/css/syntax.css media=all><link rel=stylesheet href=/css/custom.css media=all><script src=/js/script.js></script><script src=/js/custom.js></script><script defer src=/fontawesome/all.min.js></script></head><body><header class=site-header><nav class=site-navi><h1 class=site-title><a href=/>维修区刷紫</a></h1><ul class=site-navi-items><li class=site-navi-item-archives><a href=/archives/ title=所有文章>所有文章</a></li><li class=site-navi-item-categories><a href=/categories/ title=类别>类别</a></li><li class=site-navi-item-about><a href=/about/ title=关于我>关于我</a></li></ul></nav></header><hr class=site-header-bottom><div class=main role=main><article class=article><h1 class=article-title>【Redis源码分析】Redis启动过程是这样的！</h1><hr class=article-title-bottom><ul class=article-meta><li class=article-meta-date><time>2020-07-21</time></li><li class=article-meta-categories><a href=/categories/redis/><i class="fa-solid fa-folder"></i>
redis
</a>&nbsp;</li><li class=article-meta-categories><a href=/categories/linux%E5%86%85%E6%A0%B8/><i class="fa-solid fa-folder"></i>
Linux内核
</a>&nbsp;</li><li class=article-meta-categories><a href=/categories/c/c++/><i class="fa-solid fa-folder"></i>
C/C++
</a>&nbsp;</li></ul><aside class=toc><nav id=TableOfContents></nav></aside><p>redis的源码确实是比我想象中要好读，本身是过程式编程，所以很多核心逻辑已经包含在main函数的调用链，流程非常长，耐心看下去还是能get到些东西的。</p><p>main函数包含了很多逻辑：哨兵模式、定时任务、持久化、模块加载、从磁盘加载数据等等，每个地方都能单独拎出来讲，这里就不说太多了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>**</span><span class=n>argv</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=nc>timeval</span> <span class=n>tv</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>j</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/* We need to initialize our libraries, and the server configuration. */</span>
</span></span><span class=line><span class=cl><span class=cp>#ifdef INIT_SETPROCTITLE_REPLACEMENT
</span></span></span><span class=line><span class=cl><span class=cp></span>    <span class=n>spt_init</span><span class=p>(</span><span class=n>argc</span><span class=p>,</span> <span class=n>argv</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=cp>#endif
</span></span></span><span class=line><span class=cl><span class=cp></span>    <span class=c1>//设置地域，对字符集有影响
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>setlocale</span><span class=p>(</span><span class=n>LC_COLLATE</span><span class=p>,</span><span class=s>&#34;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>tzset</span><span class=p>();</span> <span class=c1>//时区设置
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//写异常报告
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>zmalloc_set_oom_handler</span><span class=p>(</span><span class=n>redisOutOfMemoryHandler</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>srand</span><span class=p>(</span><span class=n>time</span><span class=p>(</span><span class=nb>NULL</span><span class=p>)</span><span class=o>^</span><span class=n>getpid</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=n>gettimeofday</span><span class=p>(</span><span class=o>&amp;</span><span class=n>tv</span><span class=p>,</span><span class=nb>NULL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>hashseed</span><span class=p>[</span><span class=mi>16</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=c1>//从/dev/urandom文件获取随机数生成dict所需的随机种子
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//urandom记录系统混乱值，包括软硬件信息
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>getRandomHexChars</span><span class=p>(</span><span class=n>hashseed</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>hashseed</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=n>dictSetHashFunctionSeed</span><span class=p>((</span><span class=kt>uint8_t</span><span class=o>*</span><span class=p>)</span><span class=n>hashseed</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>server</span><span class=p>.</span><span class=n>sentinel_mode</span> <span class=o>=</span> <span class=n>checkForSentinelMode</span><span class=p>(</span><span class=n>argc</span><span class=p>,</span><span class=n>argv</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>initServerConfig</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>moduleInitModulesSystem</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/* Store the executable path and arguments in a safe place in order
</span></span></span><span class=line><span class=cl><span class=cm>     * to be able to restart the server later. */</span>
</span></span><span class=line><span class=cl>    <span class=n>server</span><span class=p>.</span><span class=n>executable</span> <span class=o>=</span> <span class=n>getAbsolutePath</span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=mi>0</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=n>server</span><span class=p>.</span><span class=n>exec_argv</span> <span class=o>=</span> <span class=n>zmalloc</span><span class=p>(</span><span class=k>sizeof</span><span class=p>(</span><span class=kt>char</span><span class=o>*</span><span class=p>)</span><span class=o>*</span><span class=p>(</span><span class=n>argc</span><span class=o>+</span><span class=mi>1</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=n>server</span><span class=p>.</span><span class=n>exec_argv</span><span class=p>[</span><span class=n>argc</span><span class=p>]</span> <span class=o>=</span> <span class=nb>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=n>argc</span><span class=p>;</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span> <span class=n>server</span><span class=p>.</span><span class=n>exec_argv</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>zstrdup</span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/* We need to init sentinel right now as parsing the configuration file
</span></span></span><span class=line><span class=cl><span class=cm>     * in sentinel mode will have the effect of populating the sentinel
</span></span></span><span class=line><span class=cl><span class=cm>     * data structures with master nodes to monitor. */</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>server</span><span class=p>.</span><span class=n>sentinel_mode</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>initSentinelConfig</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>initSentinel</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/* Check if we need to start in redis-check-rdb/aof mode. We just execute
</span></span></span><span class=line><span class=cl><span class=cm>     * the program main. However the program is part of the Redis executable
</span></span></span><span class=line><span class=cl><span class=cm>     * so that we can easily execute an RDB check on loading errors. */</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>strstr</span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=s>&#34;redis-check-rdb&#34;</span><span class=p>)</span> <span class=o>!=</span> <span class=nb>NULL</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>redis_check_rdb_main</span><span class=p>(</span><span class=n>argc</span><span class=p>,</span><span class=n>argv</span><span class=p>,</span><span class=nb>NULL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>strstr</span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=s>&#34;redis-check-aof&#34;</span><span class=p>)</span> <span class=o>!=</span> <span class=nb>NULL</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>redis_check_aof_main</span><span class=p>(</span><span class=n>argc</span><span class=p>,</span><span class=n>argv</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>     * 这里有一大段参数处理，被我去掉
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 管理守护线程的方式
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// service redis restart
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// systemctl start redis
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// 直接kill -9，redis会被重新拉起，以防误杀
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>server</span><span class=p>.</span><span class=n>supervised</span> <span class=o>=</span> <span class=n>redisIsSupervised</span><span class=p>(</span><span class=n>server</span><span class=p>.</span><span class=n>supervised_mode</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>background</span> <span class=o>=</span> <span class=n>server</span><span class=p>.</span><span class=n>daemonize</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=n>server</span><span class=p>.</span><span class=n>supervised</span><span class=p>;</span> <span class=c1>// 后台运行
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=n>background</span><span class=p>)</span> <span class=n>daemonize</span><span class=p>();</span> <span class=c1>// 调用setsid()，父子进程脱离
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1>// 初始化socket、eventloop、定时器: 持久化任务、超时任务
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// 初始化持久化进程通讯用的通道
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>initServer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>background</span> <span class=o>||</span> <span class=n>server</span><span class=p>.</span><span class=n>pidfile</span><span class=p>)</span> <span class=n>createPidFile</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>redisSetProcTitle</span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=mi>0</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=n>redisAsciiArt</span><span class=p>();</span> <span class=c1>// 打印LOGO
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>checkTcpBacklogSettings</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>server</span><span class=p>.</span><span class=n>sentinel_mode</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=cm>/* Things not needed when running in Sentinel mode. */</span>
</span></span><span class=line><span class=cl>        <span class=n>serverLog</span><span class=p>(</span><span class=n>LL_WARNING</span><span class=p>,</span><span class=s>&#34;Server initialized&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=cp>#ifdef __linux__
</span></span></span><span class=line><span class=cl><span class=cp></span>        <span class=n>linuxMemoryWarnings</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=cp>#endif
</span></span></span><span class=line><span class=cl><span class=cp></span>        <span class=n>moduleLoadFromQueue</span><span class=p>();</span> <span class=c1>// 加载module
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>InitServerLast</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>loadDataFromDisk</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>server</span><span class=p>.</span><span class=n>cluster_enabled</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>verifyClusterConfigWithData</span><span class=p>()</span> <span class=o>==</span> <span class=n>C_ERR</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>serverLog</span><span class=p>(</span><span class=n>LL_WARNING</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s>&#34;You can&#39;t have keys in a DB different than DB 0 when in &#34;</span>
</span></span><span class=line><span class=cl>                    <span class=s>&#34;Cluster mode. Exiting.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>InitServerLast</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>sentinelIsRunning</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/* Warning the user about suspicious maxmemory setting. */</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>server</span><span class=p>.</span><span class=n>maxmemory</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=n>server</span><span class=p>.</span><span class=n>maxmemory</span> <span class=o>&lt;</span> <span class=mi>1024</span><span class=o>*</span><span class=mi>1024</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>serverLog</span><span class=p>(</span><span class=n>LL_WARNING</span><span class=p>,</span><span class=s>&#34;WARNING: You specified a maxmemory value that is less than 1MB (current value is %llu bytes). Are you sure this is what you really want?&#34;</span><span class=p>,</span> <span class=n>server</span><span class=p>.</span><span class=n>maxmemory</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 依次做了
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// 1、集群模式下，更新节点状态
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// 2、清理过期Key-Value
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// 3、向从库同步数据
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// 4、主从同步时，会锁住客户端请求，并在这里释放锁
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// 5、尝试执行被刮起的客户端命令
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// 6、持久化AOF
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// 7、处理被阻塞的向客户端写操作
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// 8、释放拓展模块的全局锁（在加载conf以配置的module时加了独自锁）
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>aeSetBeforeSleepProc</span><span class=p>(</span><span class=n>server</span><span class=p>.</span><span class=n>el</span><span class=p>,</span><span class=n>beforeSleep</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 获取拓展模块的全局锁
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>aeSetAfterSleepProc</span><span class=p>(</span><span class=n>server</span><span class=p>.</span><span class=n>el</span><span class=p>,</span><span class=n>afterSleep</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>aeMain</span><span class=p>(</span><span class=n>server</span><span class=p>.</span><span class=n>el</span><span class=p>);</span>  <span class=c1>// 这是正式启动轮训，单线程处理请求
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>aeDeleteEventLoop</span><span class=p>(</span><span class=n>server</span><span class=p>.</span><span class=n>el</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><code>initServer</code>初始化了一堆文件or时间监听的事件，其中任务较重的应该是<code>serverCron</code>了，有机会再细说。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>void</span> <span class=nf>initServer</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>j</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>signal</span><span class=p>(</span><span class=n>SIGHUP</span><span class=p>,</span> <span class=n>SIG_IGN</span><span class=p>);</span> <span class=c1>// 忽略终端会话结束
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>signal</span><span class=p>(</span><span class=n>SIGPIPE</span><span class=p>,</span> <span class=n>SIG_IGN</span><span class=p>);</span> <span class=c1>// 若不忽略信号会出现Broken pipe，且退出进程
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>setupSignalHandlers</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>server</span><span class=p>.</span><span class=n>syslog_enabled</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>openlog</span><span class=p>(</span><span class=n>server</span><span class=p>.</span><span class=n>syslog_ident</span><span class=p>,</span> <span class=n>LOG_PID</span> <span class=o>|</span> <span class=n>LOG_NDELAY</span> <span class=o>|</span> <span class=n>LOG_NOWAIT</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>server</span><span class=p>.</span><span class=n>syslog_facility</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>createSharedObjects</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>adjustOpenFilesLimit</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>server</span><span class=p>.</span><span class=n>el</span> <span class=o>=</span> <span class=n>aeCreateEventLoop</span><span class=p>(</span><span class=n>server</span><span class=p>.</span><span class=n>maxclients</span><span class=o>+</span><span class=n>CONFIG_FDSET_INCR</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>server</span><span class=p>.</span><span class=n>el</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>//err log
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>server</span><span class=p>.</span><span class=n>db</span> <span class=o>=</span> <span class=n>zmalloc</span><span class=p>(</span><span class=k>sizeof</span><span class=p>(</span><span class=n>redisDb</span><span class=p>)</span><span class=o>*</span><span class=n>server</span><span class=p>.</span><span class=n>dbnum</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/* Open the TCP listening socket for the user commands. */</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>server</span><span class=p>.</span><span class=n>port</span> <span class=o>!=</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>        <span class=n>listenToPort</span><span class=p>(</span><span class=n>server</span><span class=p>.</span><span class=n>port</span><span class=p>,</span><span class=n>server</span><span class=p>.</span><span class=n>ipfd</span><span class=p>,</span><span class=o>&amp;</span><span class=n>server</span><span class=p>.</span><span class=n>ipfd_count</span><span class=p>)</span> <span class=o>==</span> <span class=n>C_ERR</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 本地进程通信，用于安全访问
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=cm>/* Open the listening Unix domain socket. */</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>server</span><span class=p>.</span><span class=n>unixsocket</span> <span class=o>!=</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>unlink</span><span class=p>(</span><span class=n>server</span><span class=p>.</span><span class=n>unixsocket</span><span class=p>);</span> <span class=cm>/* don&#39;t care if this fails */</span>
</span></span><span class=line><span class=cl>        <span class=n>server</span><span class=p>.</span><span class=n>sofd</span> <span class=o>=</span> <span class=n>anetUnixServer</span><span class=p>(</span><span class=n>server</span><span class=p>.</span><span class=n>neterr</span><span class=p>,</span><span class=n>server</span><span class=p>.</span><span class=n>unixsocket</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>server</span><span class=p>.</span><span class=n>unixsocketperm</span><span class=p>,</span> <span class=n>server</span><span class=p>.</span><span class=n>tcp_backlog</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>server</span><span class=p>.</span><span class=n>sofd</span> <span class=o>==</span> <span class=n>ANET_ERR</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>serverLog</span><span class=p>(</span><span class=n>LL_WARNING</span><span class=p>,</span> <span class=s>&#34;Opening Unix socket: %s&#34;</span><span class=p>,</span> <span class=n>server</span><span class=p>.</span><span class=n>neterr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>anetNonBlock</span><span class=p>(</span><span class=nb>NULL</span><span class=p>,</span><span class=n>server</span><span class=p>.</span><span class=n>sofd</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/* Abort if there are no listening sockets at all. */</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>server</span><span class=p>.</span><span class=n>ipfd_count</span> <span class=o>==</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=n>server</span><span class=p>.</span><span class=n>sofd</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// exit
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=n>server</span><span class=p>.</span><span class=n>dbnum</span><span class=p>;</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>//配置server.db属性，默认16个
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>     * 省略一堆server设置
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 处理客户端超时、无法访问的超时key、定时定量持久化
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=n>aeCreateTimeEvent</span><span class=p>(</span><span class=n>server</span><span class=p>.</span><span class=n>el</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>serverCron</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>)</span> <span class=o>==</span> <span class=n>AE_ERR</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// exit
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/* Create an event handler for accepting new connections in TCP and Unix
</span></span></span><span class=line><span class=cl><span class=cm>     * domain sockets. */</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=n>server</span><span class=p>.</span><span class=n>ipfd_count</span><span class=p>;</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>aeCreateFileEvent</span><span class=p>(</span><span class=n>server</span><span class=p>.</span><span class=n>el</span><span class=p>,</span> <span class=n>server</span><span class=p>.</span><span class=n>ipfd</span><span class=p>[</span><span class=n>j</span><span class=p>],</span> <span class=n>AE_READABLE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>acceptTcpHandler</span><span class=p>,</span><span class=nb>NULL</span><span class=p>)</span> <span class=o>==</span> <span class=n>AE_ERR</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>serverPanic</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=s>&#34;Unrecoverable error creating server.ipfd file event.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>server</span><span class=p>.</span><span class=n>sofd</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=n>aeCreateFileEvent</span><span class=p>(</span><span class=n>server</span><span class=p>.</span><span class=n>el</span><span class=p>,</span><span class=n>server</span><span class=p>.</span><span class=n>sofd</span><span class=p>,</span><span class=n>AE_READABLE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>acceptUnixHandler</span><span class=p>,</span><span class=nb>NULL</span><span class=p>)</span> <span class=o>==</span> <span class=n>AE_ERR</span><span class=p>)</span> <span class=n>serverPanic</span><span class=p>(</span><span class=s>&#34;Unrecoverable error creating server.sofd file event.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 若被阻塞的客户端需要时可唤醒轮训，在beforeSleep尝试执行完客户端请求，moduleBlockedClientPipeReadable为空方法
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=n>aeCreateFileEvent</span><span class=p>(</span><span class=n>server</span><span class=p>.</span><span class=n>el</span><span class=p>,</span> <span class=n>server</span><span class=p>.</span><span class=n>module_blocked_pipe</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>AE_READABLE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>moduleBlockedClientPipeReadable</span><span class=p>,</span><span class=nb>NULL</span><span class=p>)</span> <span class=o>==</span> <span class=n>AE_ERR</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>serverPanic</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=s>&#34;Error registering the readable event for the module &#34;</span>
</span></span><span class=line><span class=cl>                <span class=s>&#34;blocked clients subsystem.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/* Open the AOF file if needed. */</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>server</span><span class=p>.</span><span class=n>aof_state</span> <span class=o>==</span> <span class=n>AOF_ON</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>server</span><span class=p>.</span><span class=n>aof_fd</span> <span class=o>=</span> <span class=n>open</span><span class=p>(</span><span class=n>server</span><span class=p>.</span><span class=n>aof_filename</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                               <span class=n>O_WRONLY</span><span class=o>|</span><span class=n>O_APPEND</span><span class=o>|</span><span class=n>O_CREAT</span><span class=p>,</span><span class=mo>0644</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>server</span><span class=p>.</span><span class=n>aof_fd</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// exit
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 考虑32为系统地址空间仅为4G，所以在没有指定maxmemory下限制3G，以为内存不足而无法工作
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=n>server</span><span class=p>.</span><span class=n>arch_bits</span> <span class=o>==</span> <span class=mi>32</span> <span class=o>&amp;&amp;</span> <span class=n>server</span><span class=p>.</span><span class=n>maxmemory</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>serverLog</span><span class=p>(</span><span class=n>LL_WARNING</span><span class=p>,</span><span class=s>&#34;Warning: 32 bit instance detected but no memory limit set. Setting 3 GB maxmemory limit with &#39;noeviction&#39; policy now.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>server</span><span class=p>.</span><span class=n>maxmemory</span> <span class=o>=</span> <span class=mi>3072LL</span><span class=o>*</span><span class=p>(</span><span class=mi>1024</span><span class=o>*</span><span class=mi>1024</span><span class=p>);</span> <span class=cm>/* 3 GB */</span>
</span></span><span class=line><span class=cl>        <span class=n>server</span><span class=p>.</span><span class=n>maxmemory_policy</span> <span class=o>=</span> <span class=n>MAXMEMORY_NO_EVICTION</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>server</span><span class=p>.</span><span class=n>cluster_enabled</span><span class=p>)</span> <span class=n>clusterInit</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>replicationScriptCacheInit</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>scriptingInit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>slowlogInit</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>latencyMonitorInit</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></article><ul class=article-share><li><a class=resp-sharing-button__link href="https://facebook.com/sharer/sharer.php?u=/redis%25E6%25BA%2590%25E7%25A0%2581%25E5%2588%2586%25E6%259E%2590redis%25E5%2590%25AF%25E5%258A%25A8%25E8%25BF%2587%25E7%25A8%258B%25E6%2598%25AF%25E8%25BF%2599%25E6%25A0%25B7%25E7%259A%2584/" target=_blank rel=noopener aria-label=Facebook><div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--medium"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><i class="fa-brands fa-facebook-f"></i></div>Facebook</div></a></li><li><a class=resp-sharing-button__link href="https://x.com/intent/tweet/?text=%e3%80%90Redis%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90%e3%80%91Redis%e5%90%af%e5%8a%a8%e8%bf%87%e7%a8%8b%e6%98%af%e8%bf%99%e6%a0%b7%e7%9a%84%ef%bc%81%20-%20%e7%bb%b4%e4%bf%ae%e5%8c%ba%e5%88%b7%e7%b4%ab&amp;url=/redis%25E6%25BA%2590%25E7%25A0%2581%25E5%2588%2586%25E6%259E%2590redis%25E5%2590%25AF%25E5%258A%25A8%25E8%25BF%2587%25E7%25A8%258B%25E6%2598%25AF%25E8%25BF%2599%25E6%25A0%25B7%25E7%259A%2584/" target=_blank rel=noopener aria-label=Twitter><div class="resp-sharing-button resp-sharing-button--x resp-sharing-button--medium"><i class="fa-brands fa-x-twitter"></i></div></a></li></ul><ul class="pager article-pager"><li class=pager-newer><a href=/redis%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90redis%E7%9C%9F%E7%9A%84%E4%B8%8D%E6%98%AF%E5%8D%95%E7%BA%BF%E7%A8%8B%E5%90%8E%E5%8F%B0io%E6%9C%8D%E5%8A%A1-bio/ data-toggle=tooltip data-placement=top title="【Redis源码分析】Redis真的不是单线程，后台IO服务 BIO">&lt; Newer</a></li><li class=pager-older><a href=/%E9%97%AE%E9%A2%98%E5%B0%8F%E8%A7%A3%E5%86%B3pid%E8%80%97%E5%B0%BD%E7%9A%84%E5%8D%B1%E5%AE%B3/ data-toggle=tooltip data-placement=top title=【问题小解决】PID耗尽的危害>Older ></a></li></ul></div><div class=site-footer><div class=copyright>© 2025 黄泽宏 | <a href=https://beian.miit.gov.cn/ target=_blank>粤ICP备2025417888号-1</a></div><ul class=site-footer-items><li class=site-footer-item-about><a href=/about/ title=About>About</a></li></ul><div class=powerdby>Powered by <a href=https://gohugo.io/>Hugo</a> and <a href=https://github.com/taikii/whiteplain>Whiteplain</a>
<script>fetch("https://ghtrk-pixel.fly.dev/goodtracker.png?from=hugo-footer-huangzehong_me&ts="+Date.now())</script></div></div><script async src="https://www.googletagmanager.com/gtag/js?id=G-16F0MHER15"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-16F0MHER15",{anonymize_ip:!1})}</script></body></html>